<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Defient Flag Football Game</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      background: #000;
    }
    canvas {
      display: block;
      background-color: #228B22;
    }
    #ui {
      position: absolute;
      top: 10px;
      width: 100%;
      text-align: center;
      color: white;
    }
    button {
      margin: 5px;
      padding: 10px;
    }
  </style>
</head>
<body>
  <canvas id="gameCanvas"></canvas>
  <div id="ui">
    <div id="status"></div>
    <button onclick="startGame()">Start Game</button>
  </div>
  <script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    const playerSize = 30;
    const defenderSize = 30;
    let offensivePlayers = [];
    let defenders = [];
    let ballCarrierIndex = null;
    let keys = {};
    let gameRunning = false;
    let playStarted = false;

    function createOffense() {
      offensivePlayers = [];
      const spacing = canvas.height / 5;
      for (let i = 0; i < 4; i++) {
        offensivePlayers.push({
          x: 100,
          y: spacing * (i + 1),
          hasBall: false
        });
      }
      ballCarrierIndex = null; // Wait for user to click
    }

    function createDefense() {
      defenders = [];
      const formation = Math.floor(Math.random() * 3); // 0: Cover 1, 1: Cover 2, 2: Cover 3
      const midY = canvas.height / 2;
      if (formation === 0) {
        // Cover 1: 1 deep, 3 man
        defenders.push({ x: canvas.width - 200, y: midY - 100 });
        defenders.push({ x: canvas.width - 400, y: 100 });
        defenders.push({ x: canvas.width - 400, y: midY });
        defenders.push({ x: canvas.width - 400, y: canvas.height - 100 });
      } else if (formation === 1) {
        // Cover 2: 2 deep, 2 man
        defenders.push({ x: canvas.width - 200, y: 100 });
        defenders.push({ x: canvas.width - 200, y: canvas.height - 100 });
        defenders.push({ x: canvas.width - 400, y: midY - 150 });
        defenders.push({ x: canvas.width - 400, y: midY + 150 });
      } else {
        // Cover 3: 3 deep, 1 mid
        defenders.push({ x: canvas.width - 200, y: 100 });
        defenders.push({ x: canvas.width - 200, y: midY });
        defenders.push({ x: canvas.width - 200, y: canvas.height - 100 });
        defenders.push({ x: canvas.width - 400, y: midY });
      }
    }

    function drawPlayers() {
      for (let i = 0; i < offensivePlayers.length; i++) {
        const p = offensivePlayers[i];
        ctx.fillStyle = p.hasBall ? 'yellow' : 'white';
        ctx.fillRect(p.x, p.y, playerSize, playerSize);
        if (p.hasBall) {
          ctx.fillStyle = 'blue';
          ctx.fillRect(p.x + playerSize, p.y + playerSize / 3, 6, 10); // Flag visual
        }
      }
    }

    function drawDefenders() {
      ctx.fillStyle = 'red';
      for (let d of defenders) {
        ctx.fillRect(d.x, d.y, defenderSize, defenderSize);
      }
    }

    function updateBallCarrierMovement() {
      if (ballCarrierIndex === null) return;
      const p = offensivePlayers[ballCarrierIndex];
      if (keys["ArrowUp"]) p.y -= 3;
      if (keys["ArrowDown"]) p.y += 3;
      if (keys["ArrowLeft"]) p.x -= 3;
      if (keys["ArrowRight"]) p.x += 4.5; // right gets boost
    }

    function updateDefenders() {
      if (ballCarrierIndex === null) return;
      const target = offensivePlayers[ballCarrierIndex];
      for (let d of defenders) {
        const dx = target.x - d.x;
        const dy = target.y - d.y;
        const dist = Math.sqrt(dx * dx + dy * dy);
        if (dist > 0) {
          d.x += (dx / dist) * 1.5;
          d.y += (dy / dist) * 1.5;
        }

        if (
          target.x < d.x + defenderSize &&
          target.x + playerSize > d.x &&
          target.y < d.y + defenderSize &&
          target.y + playerSize > d.y
        ) {
          gameRunning = false;
          playStarted = false;
          alert("Flag grabbed! Game over.");
        }
      }
    }

    function draw() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.fillStyle = '#006400';
      ctx.fillRect(canvas.width - 50, 0, 50, canvas.height);
      ctx.save();
      ctx.fillStyle = 'white';
      ctx.translate(canvas.width - 25, canvas.height / 2);
      ctx.rotate(Math.PI / 2);
      ctx.fillText("Defient Sports", -ctx.measureText("Defient Sports").width / 2, 0);
      ctx.restore();
      drawPlayers();
      drawDefenders();
      updateBallCarrierMovement();
      updateDefenders();
    }

    function gameLoop() {
      draw();
      if (gameRunning) requestAnimationFrame(gameLoop);
    }

    function startGame() {
      createOffense();
      createDefense();
      gameRunning = true;
      playStarted = false;
      requestAnimationFrame(gameLoop);
    }

    canvas.addEventListener("click", function (e) {
      if (!playStarted) {
        const rect = canvas.getBoundingClientRect();
        const mouseX = e.clientX - rect.left;
        const mouseY = e.clientY - rect.top;
        offensivePlayers.forEach((p, i) => {
          if (
            mouseX >= p.x && mouseX <= p.x + playerSize &&
            mouseY >= p.y && mouseY <= p.y + playerSize
          ) {
            offensivePlayers.forEach(p => p.hasBall = false);
            p.hasBall = true;
            ballCarrierIndex = i;
            playStarted = true;
          }
        });
      } else if (playStarted && ballCarrierIndex !== null) {
        const carrier = offensivePlayers[ballCarrierIndex];
        const rect = canvas.getBoundingClientRect();
        const mouseX = e.clientX - rect.left;
        const mouseY = e.clientY - rect.top;
        offensivePlayers.forEach((p, i) => {
          if (
            i !== ballCarrierIndex &&
            mouseX >= p.x && mouseX <= p.x + playerSize &&
            mouseY >= p.y && mouseY <= p.y + playerSize &&
            p.x <= carrier.x
          ) {
            offensivePlayers[ballCarrierIndex].hasBall = false;
            p.hasBall = true;
            ballCarrierIndex = i;
          }
        });
      }
    });

    document.addEventListener("keydown", e => keys[e.key] = true);
    document.addEventListener("keyup", e => keys[e.key] = false);
  </script>
</body>
</html>
