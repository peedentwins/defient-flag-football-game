<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Defient Flag Football Game</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      background: #000;
    }
    canvas {
      display: block;
      background-color: #228B22;
    }
    #ui {
      position: absolute;
      top: 10px;
      width: 100%;
      text-align: center;
      color: white;
    }
    button {
      margin: 5px;
      padding: 10px;
    }
    .mobile-btn {
      position: absolute;
      bottom: 20px;
      background-color: rgba(255,255,255,0.6);
      border: none;
      padding: 10px 15px;
      font-size: 18px;
      border-radius: 5px;
    }
    #lateralButtons button {
      margin: 3px;
    }
  </style>
</head>
<body>
  <canvas id="gameCanvas"></canvas>
  <div id="ui">
    <div id="status"></div>
    <button onclick="startGame()">Start Game</button>
    <div id="lateralButtons" style="display:none">
      <button onclick="lateralTo(1)">1</button>
      <button onclick="lateralTo(2)">2</button>
      <button onclick="lateralTo(3)">3</button>
    </div>
  </div>
  <script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    const fieldWidth = canvas.width;
    const fieldHeight = canvas.height;

    const playerSize = 30;
    let offensivePlayers = [];
    let ballCarrierIndex = 0;
    let keys = {};
    let gameRunning = false;

    function createOffense() {
      offensivePlayers = [];
      const spacing = fieldHeight / 5;
      for (let i = 0; i < 4; i++) {
        offensivePlayers.push({
          x: 100,
          y: spacing * (i + 1),
          hasBall: false
        });
      }
      ballCarrierIndex = Math.floor(Math.random() * 4);
      offensivePlayers[ballCarrierIndex].hasBall = true;
    }

    function drawPlayers() {
      for (let i = 0; i < offensivePlayers.length; i++) {
        const p = offensivePlayers[i];
        ctx.fillStyle = p.hasBall ? 'yellow' : 'white';
        ctx.fillRect(p.x, p.y, playerSize, playerSize);
        if (p.hasBall) {
          ctx.fillStyle = 'blue';
          ctx.fillRect(p.x + playerSize, p.y + playerSize/3, 6, 10); // Flag visual
        }
      }
    }

    function updateBallCarrierMovement() {
      const p = offensivePlayers[ballCarrierIndex];
      if (keys["ArrowUp"]) p.y -= 3;
      if (keys["ArrowDown"]) p.y += 3;
      if (keys["ArrowLeft"]) p.x -= 3;
      if (keys["ArrowRight"]) p.x += 4.5; // right gets boost
    }

    function lateralTo(index) {
      if (index >= offensivePlayers.length || index === ballCarrierIndex) return;
      const carrier = offensivePlayers[ballCarrierIndex];
      const target = offensivePlayers[index];
      if (target.x <= carrier.x) { // Only allow lateral backward
        carrier.hasBall = false;
        target.hasBall = true;
        ballCarrierIndex = index;
      }
    }

    function draw() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      // Touchdown Zone
      ctx.fillStyle = '#006400';
      ctx.fillRect(canvas.width - 50, 0, 50, canvas.height);
      ctx.save();
      ctx.fillStyle = 'white';
      ctx.translate(canvas.width - 25, canvas.height / 2);
      ctx.rotate(Math.PI / 2);
      ctx.fillText("Defient Sports", -ctx.measureText("Defient Sports").width / 2, 0);
      ctx.restore();

      drawPlayers();
      updateBallCarrierMovement();
    }

    function gameLoop() {
      draw();
      if (gameRunning) requestAnimationFrame(gameLoop);
    }

    function startGame() {
      createOffense();
      document.getElementById("lateralButtons").style.display = "block";
      if (!gameRunning) {
        gameRunning = true;
        requestAnimationFrame(gameLoop);
      }
    }

    document.addEventListener("keydown", e => {
      keys[e.key] = true;
      if (["1", "2", "3"].includes(e.key)) {
        lateralTo(parseInt(e.key));
      }
    });

    document.addEventListener("keyup", e => keys[e.key] = false);
  </script>
</body>
</html>
